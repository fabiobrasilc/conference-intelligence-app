<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ESMO 2025 ‚Äî Conference Intelligence Platform</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body>
    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Left Sidebar for Filters -->
    <aside class="filter-sidebar collapsed" id="filterSidebar">
      <div class="sidebar-header">
        <div class="d-flex align-items-center justify-content-between">
          <h6 class="mb-0 fw-bold">üß∞ Filters</h6>
          <button class="btn btn-sm btn-link text-decoration-none" id="clearAllFilters">Clear All</button>
        </div>
        <div class="filter-count-badge" id="filterCountBadge">0 active</div>
      </div>

      <div class="sidebar-content">
        <!-- Drug Focus Section -->
        <div class="filter-section">
          <div class="filter-section-header" data-section="drug">
            <span class="section-title">üéØ Drug Focus</span>
            <span class="chevron">‚Ä∫</span>
          </div>
          <div class="filter-options">
            <button class="filter-toggle-btn drug-filter-btn" data-value="Avelumab Focus">Avelumab</button>
            <button class="filter-toggle-btn drug-filter-btn" data-value="Tepotinib Focus">Tepotinib</button>
            <button class="filter-toggle-btn drug-filter-btn" data-value="Cetuximab Focus">Cetuximab</button>
          </div>
        </div>

        <!-- Therapeutic Area Section -->
        <div class="filter-section">
          <div class="filter-section-header" data-section="ta">
            <span class="section-title">üè• Therapeutic Area</span>
            <span class="chevron">‚Ä∫</span>
          </div>
          <div class="filter-options">
            <button class="filter-toggle-btn ta-filter-btn" data-value="Bladder Cancer">Bladder Cancer</button>
            <button class="filter-toggle-btn ta-filter-btn" data-value="Renal Cancer">Renal Cancer</button>
            <button class="filter-toggle-btn ta-filter-btn" data-value="Lung Cancer">Lung Cancer</button>
            <button class="filter-toggle-btn ta-filter-btn" data-value="Colorectal Cancer">Colorectal Cancer</button>
            <button class="filter-toggle-btn ta-filter-btn" data-value="Head and Neck Cancer">Head & Neck Cancer</button>
            <button class="filter-toggle-btn ta-filter-btn" data-value="TGCT">TGCT</button>
            <button class="filter-toggle-btn ta-filter-btn" data-value="Merkel Cell">Merkel Cell</button>
          </div>
        </div>

        <!-- Session Type Section -->
        <div class="filter-section">
          <div class="filter-section-header" data-section="session">
            <span class="section-title">üìã Session Type</span>
            <span class="chevron">‚Ä∫</span>
          </div>
          <div class="filter-options">
            <button class="filter-toggle-btn session-filter-btn" data-value="Poster">Poster</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="ePoster">ePoster</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Proffered Paper">Proffered Paper</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Mini Oral Session">Mini Oral</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Educational Session">Educational</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Symposia">Symposia</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Industry-Sponsored Symposium">Industry-Sponsored</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Multidisciplinary Session">Multidisciplinary</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Special Session">Special</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Young Oncologists Session">Young Oncologists</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Challenge Your Expert">Challenge Expert</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Patient Advocacy Session">Patient Advocacy</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="EONS Session">EONS</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Highlights">Highlights</button>
            <button class="filter-toggle-btn session-filter-btn" data-value="Keynote Lecture">Keynote Lecture</button>
          </div>
        </div>

        <!-- Conference Day Section -->
        <div class="filter-section">
          <div class="filter-section-header" data-section="date">
            <span class="section-title">üìÖ Conference Day</span>
            <span class="chevron">‚Ä∫</span>
          </div>
          <div class="filter-options">
            <button class="filter-toggle-btn date-filter-btn" data-value="Day 1">Oct 17th</button>
            <button class="filter-toggle-btn date-filter-btn" data-value="Day 2">Oct 18th</button>
            <button class="filter-toggle-btn date-filter-btn" data-value="Day 3">Oct 19th</button>
            <button class="filter-toggle-btn date-filter-btn" data-value="Day 4">Oct 20th</button>
            <button class="filter-toggle-btn date-filter-btn" data-value="Day 5">Oct 21st</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Quick Intelligence Sidebar (AI Assistant only) -->
    <aside class="quick-intel-sidebar" id="quickIntelSidebar">
      <div class="quick-intel-header">
        <span class="quick-intel-icon">‚ö°</span>
        <h6 class="quick-intel-title">Quick Intelligence</h6>
        <span class="chevron-toggle">‚Äπ</span>
      </div>
      <div class="quick-intel-content">
        <p class="qi-instructions">Use the buttons below to see comprehensive AI-powered reports on each topic.</p>
        <div class="action-chip playbook-trigger" data-playbook="strategic" title="Executive strategic briefing: Synthesizes all intelligence reports into actionable recommendations for Medical Affairs, MSLs, and HQ Leadership.">
          <div class="icon">üéØ</div>
          <div>
            <div class="title">Strategic Briefing</div>
            <div class="sub">Executive synthesis</div>
          </div>
        </div>
        <div class="action-chip playbook-trigger" data-playbook="insights" title="Discover scientific trends: Biomarker/MOA frequency analysis with study identifiers, emerging mechanisms, treatment paradigm shifts, and Merck KGaA portfolio positioning insights.">
          <div class="icon">üìà</div>
          <div>
            <div class="title">Insights</div>
            <div class="sub">Signals, trends & themes</div>
          </div>
        </div>
        <div class="action-chip playbook-trigger" data-playbook="competitor" title="Analyze the competitive landscape: Drug rankings by study count, MOA class distribution, emerging threats (3-5 abstracts), and strategic positioning insights for Merck KGaA portfolio.">
          <div class="icon">üèÜ</div>
          <div>
            <div class="title">Competition</div>
            <div class="sub">Landscape Analysis</div>
          </div>
        </div>
        <div class="action-chip playbook-trigger" data-playbook="kol" title="Generate a comprehensive KOL analysis: Top 15 most active speakers, their research focus areas, institutional affiliations, and strategic importance for Merck KGaA partnerships.">
          <div class="icon">üë©‚Äç‚öïÔ∏è</div>
          <div>
            <div class="title">KOL Analysis</div>
            <div class="sub">Authors & impact</div>
          </div>
        </div>
        <div class="action-chip playbook-trigger" data-playbook="institution" title="Identify leading research centers: Top 15 institutions by publication volume, geographic distribution, and partnership opportunities for clinical trials and collaborations.">
          <div class="icon">üè•</div>
          <div>
            <div class="title">Institutions</div>
            <div class="sub">Footprint & trials</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- App Bar -->
      <div class="appbar">
        <button class="sidebar-toggle" id="sidebarToggle">‚ò∞</button>
        <h1 class="appbar-title">COSMIC - ESMO 2025 Conference Intelligence</h1>
        <div class="appbar-tabs" role="tablist" aria-label="Main sections">
          <button class="appbar-tab active" data-bs-toggle="tab" data-bs-target="#data-explorer" type="button" role="tab" aria-controls="data-explorer" aria-selected="true">Data Explorer</button>
          <span>|</span>
          <button class="appbar-tab" data-bs-toggle="tab" data-bs-target="#ai-assistant" type="button" role="tab" aria-controls="ai-assistant" aria-selected="false">AI Assistant</button>
        </div>
        <button class="btn btn-outline-secondary btn-sm appbar-data-warning-btn" data-bs-toggle="modal" data-bs-target="#dataWarningModal">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
          </svg>
          Data Sources
        </button>
      </div>

      <!-- Hidden default nav-tabs (for bootstrap mechanics) -->
      <ul class="nav nav-tabs" id="mainTabs" role="tablist" style="display:none;">
        <li class="nav-item"><button class="nav-link active" id="data-explorer-tab" data-bs-toggle="tab" data-bs-target="#data-explorer" type="button" role="tab">Data Explorer</button></li>
        <li class="nav-item"><button class="nav-link" id="ai-assistant-tab" data-bs-toggle="tab" data-bs-target="#ai-assistant" type="button" role="tab">AI Assistant</button></li>
      </ul>

      <div class="tab-content" id="mainTabContent">

        <!-- ===================== DATA EXPLORER ===================== -->
        <div class="tab-pane fade show active" id="data-explorer" role="tabpanel" aria-labelledby="data-explorer-tab">
          <div class="content-area">

            <!-- Search Bar -->
            <div class="search-bar-container mb-3">
              <div class="input-group">
                <button class="btn btn-outline-secondary" id="clearSearchBtn" title="Clear search" style="display: none;">‚úï</button>
                <input type="text" class="form-control form-control-lg" id="searchInput" placeholder="Search titles, authors, institutions... (Boolean: AND, OR, NOT | Exact match: &quot;ATM&quot;)" />
                <button class="btn btn-primary" id="searchBtn">üîç Search</button>
              </div>
            </div>

            <!-- Column Toggle Controls -->
            <div class="column-toggle-container mb-2">
              <span class="toggle-label">Toggle Columns:</span>
              <button class="column-toggle-btn active" data-column="Title">Title</button>
              <button class="column-toggle-btn active" data-column="Speakers">Speakers</button>
              <button class="column-toggle-btn" data-column="Speaker Location">Location</button>
              <button class="column-toggle-btn active" data-column="Abstract">Abstract</button>
              <button class="column-toggle-btn active" data-column="Affiliation">Affiliation</button>
              <button class="column-toggle-btn active" data-column="Identifier">Identifier</button>
              <button class="column-toggle-btn active" data-column="Session">Session</button>
              <button class="column-toggle-btn" data-column="Room">Room</button>
              <button class="column-toggle-btn" data-column="Date">Date</button>
              <button class="column-toggle-btn" data-column="Time">Time</button>
              <button class="column-toggle-btn" data-column="Theme">Theme</button>
            </div>

            <!-- Data Table -->
            <div class="card">
              <div class="card-header">
                <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
                  <h5 class="mb-0">
                    Conference Data ‚Äî
                    <small id="filterContext" class="text-muted">Loading filter context...</small>
                  </h5>
                  <button class="btn btn-outline-secondary" id="exportBtn">Download table</button>
                </div>
              </div>
              <div class="card-body">
                <div id="tableContainer">
                  <div class="text-center py-4">
                    <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
                    <p class="mt-2 mb-0">Loading ESMO 2025 data...</p>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

        <!-- ===================== AI ASSISTANT ===================== -->
        <div class="tab-pane fade" id="ai-assistant" role="tabpanel" aria-labelledby="ai-assistant-tab">
          <div class="ai-chat-layout">

            <!-- Chat Container (Full height, centered) -->
            <div class="ai-chat-main">

              <!-- Scrollable Content Area -->
              <div class="ai-chat-scrollable">
                <!-- Greeting (shows before first message) -->
                <div id="aiGreeting" class="ai-greeting">
                  <h2 class="ai-greeting-title">Welcome to COSMIC AI</h2>
                  <p class="ai-greeting-subtitle">Your ESMO 2025 Conference Intelligence Assistant</p>

                  <div class="ai-greeting-description">
                    <p class="greeting-intro">Ask questions, explore insights, and analyze 4,686 ESMO 2025 abstracts with AI-powered conversations.</p>
                  </div>

                </div>

                <!-- Chat Messages Container -->
                <div id="chatContainer" class="ai-chat-messages">
                  <!-- Messages will appear here -->
                </div>

                <!-- Floating Jump to Bottom Button -->
                <button id="jumpToBottomBtn" class="jump-to-bottom-btn">
                  ‚Üì Bottom
                </button>
              </div>

              <!-- Chat Input (Fixed at bottom of chat area) -->
              <div class="ai-chat-input-container">
                <!-- Chat Scope Selector (Integrated into input box) -->
                <div class="chat-scope-selector">
                  <label for="chatScopeDropdown">üîç Scope:</label>
                  <select id="chatScopeDropdown" class="chat-scope-dropdown">
                    <option value="">Select the scope of the conversation here</option>
                    <option value="all">All Conference Data (4,686 studies)</option>
                    <option value="ta:Bladder Cancer">Bladder Cancer</option>
                    <option value="ta:Renal Cancer">Renal Cancer</option>
                    <option value="ta:Lung Cancer">Lung Cancer (NSCLC)</option>
                    <option value="ta:Colorectal Cancer">Colorectal Cancer</option>
                    <option value="ta:Head and Neck Cancer">Head & Neck Cancer</option>
                    <option value="ta:TGCT">TGCT</option>
                    <option value="ta:Merkel Cell">Merkel Cell</option>
                  </select>

                  <!-- Thinking Mode Selector -->
                  <label for="thinkingModeDropdown" style="margin-left: 15px;">üß† AI Thinking:</label>
                  <select id="thinkingModeDropdown" class="chat-scope-dropdown" title="Control AI reasoning depth and response detail">
                    <option value="standard" selected>Standard</option>
                    <option value="deep">üî¨ Deep Thinking</option>
                  </select>

                  <button class="download-chat-btn" id="downloadChatBtn" title="Download conversation">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                    </svg>
                    <span class="download-chat-text">Download this chat</span>
                  </button>
                </div>

                <div class="ai-chat-input-wrapper">
                  <textarea
                    id="chatInput"
                    class="ai-chat-input"
                    placeholder="Ask about conference insights, competitive intelligence, KOLs..."
                    rows="1"></textarea>
                  <button class="ai-chat-send-btn" id="chatSendBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 19V5M5 12l7-7 7 7"/>
                    </svg>
                  </button>
                </div>
              </div>

            </div>

          </div>
        </div>

      </div>
    </div>

    <!-- Quick Intelligence Filter Modal -->
    <div class="modal fade" id="quickIntelModal" tabindex="-1" aria-labelledby="quickIntelModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border-radius: 16px; border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.12);">
          <div class="modal-header" style="border-bottom: 1px solid #e9ecef; padding: 20px 24px;">
            <h5 class="modal-title fw-bold" id="quickIntelModalLabel">
              <span id="modalIcon">‚ö°</span> <span id="modalTitle">Quick Intelligence</span>
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" style="padding: 24px;">
            <p class="text-muted" id="modalInstructions" style="margin-bottom: 20px; font-size: 14px;">
              Select a filter to scope your analysis.
            </p>

            <!-- Drug Focus Filter Section -->
            <div id="modalDrugSection" class="mb-4" style="display: none;">
              <label class="form-label fw-semibold" style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">üíä EMD SERONO/MERCK KGAA ASSETS FOCUS</label>
              <div class="d-flex flex-wrap gap-2">
                <button class="modal-filter-btn" data-type="drug" data-value="Avelumab Focus">Avelumab (mUC 1LM)</button>
                <button class="modal-filter-btn" data-type="drug" data-value="Tepotinib Focus">Tepotinib (NSCLC METex14)</button>
                <button class="modal-filter-btn" data-type="drug" data-value="Cetuximab CRC">Cetuximab (mCRC)</button>
                <button class="modal-filter-btn" data-type="drug" data-value="Cetuximab H&N">Cetuximab (la/mH&N)</button>
              </div>
            </div>

            <!-- Therapeutic Area Filter Section -->
            <div id="modalTASection" class="mb-4" style="display: none;">
              <label class="form-label fw-semibold" style="font-size: 13px; color: #6c757d; margin-bottom: 12px;">üéØ THERAPEUTIC AREA</label>
              <div class="d-flex flex-wrap gap-2">
                <button class="modal-filter-btn" data-type="ta" data-value="Bladder Cancer">Bladder Cancer</button>
                <button class="modal-filter-btn" data-type="ta" data-value="Renal Cancer">Renal Cancer</button>
                <button class="modal-filter-btn" data-type="ta" data-value="Lung Cancer">Lung Cancer</button>
                <button class="modal-filter-btn" data-type="ta" data-value="Colorectal Cancer">Colorectal</button>
                <button class="modal-filter-btn" data-type="ta" data-value="Head and Neck Cancer">Head & Neck</button>
                <button class="modal-filter-btn" data-type="ta" data-value="TGCT">TGCT</button>
                <button class="modal-filter-btn" data-type="ta" data-value="Merkel Cell">Merkel Cell</button>
              </div>
            </div>

            <!-- Selected Filter Display -->
            <div id="modalSelectedFilter" class="alert alert-light" style="border-radius: 8px; font-size: 13px; margin-top: 16px; display: none;">
              <strong>Selected:</strong> <span id="modalSelectedFilterText"></span>
            </div>
          </div>
          <div class="modal-footer" style="border-top: 1px solid #e9ecef; padding: 16px 24px;">
            <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-dismiss="modal" style="border-radius: 8px;">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Warning Modal -->
    <div class="modal fade" id="dataWarningModal" tabindex="-1" aria-labelledby="dataWarningModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border-radius: 16px; border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.12);">
          <div class="modal-header" style="border-bottom: 1px solid #e9ecef; padding: 20px 24px;">
            <h5 class="modal-title fw-bold" id="dataWarningModalLabel">
              ‚ö†Ô∏è Data Sources & Important Warnings
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" style="padding: 24px;">
            <div style="margin-bottom: 20px; padding: 12px; background-color: transparent; border-left: 4px solid #8b5cf6; border-radius: 8px;">
              <strong style="color: #8b5cf6;">‚õî DO NOT SHARE CONFIDENTIAL/INTERNAL INFORMATION</strong>
              <p style="margin: 8px 0 0 0; font-size: 14px; color: #8b5cf6;">No internal EMD Serono/Merck KGaA data was used to train the AI model. All prompts are sent to OpenAI servers.</p>
            </div>

            <div style="margin-bottom: 20px;">
              <h6 class="fw-bold">Data Sources</h6>
              <ul style="font-size: 14px; margin: 8px 0;">
                <li><strong>Conference Data:</strong> All sourced from publicly available ESMO 2025 materials</li>
                <li><strong>Affiliations:</strong> Harvested from PubMed API using author + location + theme + recency matching</li>
                <li><strong>Training Data:</strong> OpenAI GPT-5-mini (general knowledge, not app-specific)</li>
              </ul>
            </div>

            <div style="margin-bottom: 20px;">
              <h6 class="fw-bold">Data Limitations</h6>
              <ul style="font-size: 14px; margin: 8px 0;">
                <li><strong>Affiliation Confidence:</strong> 80%+ perfect match; 7% of authors lack PubMed publications (likely early-career)</li>
                <li><strong>Scope:</strong> Titles, authors, sessions, and full abstracts (70% coverage). Remaining abstracts pending.</li>
                <li><strong>AI Accuracy:</strong> AI can make mistakes. Always verify critical information before acting</li>
              </ul>
            </div>

          </div>
          <div class="modal-footer" style="border-top: 1px solid #e9ecef; padding: 16px 24px;">
            <button type="button" class="btn btn-primary" data-bs-dismiss="modal" style="border-radius: 8px;">I Understand</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Chat Scope Warning Modal -->
    <div class="modal fade" id="chatScopeWarningModal" tabindex="-1" aria-labelledby="chatScopeWarningLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 16px; border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.12); max-height: 90vh; display: flex; flex-direction: column;">
          <div class="modal-header" style="border-bottom: 1px solid #e9ecef; padding: 16px 20px; background-color: #fff3cd; flex-shrink: 0;">
            <h5 class="modal-title fw-bold" id="chatScopeWarningLabel" style="font-size: 1.1rem;">
              ‚ö†Ô∏è All Conference Data Scope
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" style="padding: 16px 20px; overflow-y: auto; flex: 1;">
            <div style="margin-bottom: 12px; padding: 10px 12px; background-color: #fff3cd; border-left: 4px solid #ffc107; border-radius: 6px;">
              <p style="margin: 0; font-size: 14px; line-height: 1.5;">
                <strong>Setting the scope to all 4,686 sessions may result in longer AI response times.</strong>
              </p>
            </div>

            <div style="margin-bottom: 12px;">
              <h6 class="fw-bold" style="font-size: 0.95rem; margin-bottom: 6px;">üí° Best Practice</h6>
              <p style="font-size: 13px; margin-bottom: 8px; line-height: 1.4;">
                Select a TA from the dropdown or mention it in your prompt to speed up responses.
              </p>
            </div>

            <div style="margin-bottom: 10px;">
              <h6 class="fw-bold" style="color: #dc3545; font-size: 0.9rem; margin-bottom: 4px;">‚ùå Don't:</h6>
              <div style="padding: 8px 10px; background-color: #f8d7da; border-left: 3px solid #dc3545; border-radius: 4px; font-family: monospace; font-size: 12px; color: #721c24;">
                "Tell me about immune checkpoint inhibitors"
              </div>
              <p style="font-size: 12px; color: #666; margin: 4px 0 0 0; font-style: italic;">
                ‚Üí Searches all 4,686 studies (1-2 min wait)
              </p>
            </div>

            <div>
              <h6 class="fw-bold" style="color: #28a745; font-size: 0.9rem; margin-bottom: 4px;">‚úÖ Do:</h6>
              <div style="padding: 8px 10px; background-color: #d4edda; border-left: 3px solid #28a745; border-radius: 4px; font-family: monospace; font-size: 12px; color: #155724;">
                "Tell me about immune checkpoint inhibitors in glioblastoma"
              </div>
              <p style="font-size: 12px; color: #666; margin: 4px 0 0 0; font-style: italic;">
                ‚Üí AI narrows scope automatically (faster)
              </p>
            </div>

          </div>
          <div class="modal-footer" style="border-top: 1px solid #e9ecef; padding: 12px 20px; display: flex; justify-content: space-between; flex-shrink: 0;">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal" style="border-radius: 8px;">Go Back</button>
            <button type="button" class="btn btn-warning btn-sm" id="confirmScopeWarning" style="border-radius: 8px;">Continue with All Data</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Markdown Parser and Sanitizer for AI Intelligence Reports -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
    <script>
      marked.setOptions({
        gfm: true,
        breaks: true,        // keeps single newlines readable while streaming
        smartLists: true,
        headerIds: false
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
